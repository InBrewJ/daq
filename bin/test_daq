#!/bin/bash -e

# Out with the old, in with the new (use faucet instead).
sudo /etc/init.d/openvswitch-controller stop || true

if [ ! -f local/system.conf ]; then
    echo Installing local/system.conf...
    mkdir -p local
    cp misc/system.conf local/
fi

echo -n "Last DAQ commit "
git log -n 1 --pretty=format:"%h - %an, %ar : %s" || true

echo -n "Last FAUCET commit "
(cd $FAUCET; git log -n 1 --pretty=format:"%h - %an, %ar : %s" || true)

if [ "$MULTI" == y ]; then
    echo daq_intf='faux-1,faux-2,faux-3' >> local/system.conf
    cmd/faux 1
    cmd/faux 2
    cmd/faux 3
fi

echo Running DAQ test...
if [ "$MODE" == "in" ]; then
    cmd/run -s
else
    cmd/exrun -s
fi
