#!/bin/bash -e

MININETV="2.2.2"

# Make sure to get a reasonably up-to-date version of OVS.
sudo apt-get install apt-transport-https
echo "deb http://packages.wand.net.nz $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/wand.list
sudo curl http://packages.wand.net.nz/keyring.gpg -o /etc/apt/trusted.gpg.d/wand.gpg
sudo apt-get update

# Basic system install items.
sudo apt-get -y install \
    software-properties-common apt-transport-https \
    sudo realpath git emacs ethtool curl \
    isc-dhcp-client network-manager netcat \
    python python-setuptools python-dev build-essential python-pip \
    openvswitch-switch openvswitch-common

git clone https://github.com/mininet/mininet -b $MININETV
(
    cd mininet
    for i in ssh pep8 pyflakes python-pexpect pylint xterm ; do
        perl -pi -e "s/${i}//g" util/install.sh ;
    done
    util/install.sh -n
)

# Python extension packages
sudo pip install --index-url=https://pypi.python.org/simple netifaces

ROOT=$(realpath $(dirname $0)/..)
REPO=https://github.com/grafnu/faucet.git
BRANCH=testing
TARGET=faucet

cd $ROOT

echo Cloning $REPO branch $BRANCH into $TARGET...
git clone $REPO $TARGET --single-branch --depth 1 -b $BRANCH

#cmd/build

cmd/inbuild

