#!/bin/bash -e
#
# Setup things for building the core system. Not required for just
# running a downloaded container.
#
# If you just want to get up and goind, see bin/setup_install.
#

ROOT=$(realpath $(dirname $0)/..)
REPO=https://github.com/grafnu/faucet.git
COMMIT=$(cat $ROOT/misc/FAUCET_VERSION)
TARGET=faucet
MININETV="2.2.2"

cd $ROOT

if [ "$DAQ_BUILD" == "no" ]; then
    echo Skipping core setup because DAQ_BUILD=no
    exit 0
fi

git clone https://github.com/mininet/mininet -b $MININETV
(
    cd mininet
    for i in ssh pep8 pyflakes python-pexpect pylint xterm ; do
        perl -pi -e "s/${i}//g" util/install.sh ;
    done
    util/install.sh -n
)

# Python extension packages
sudo pip install --index-url=https://pypi.python.org/simple \
    netifaces google-cloud-pubsub==0.32.1

echo Cloning $REPO hash $COMMIT into $TARGET...
git clone -n $REPO $TARGET
(cd $TARGET; git checkout $COMMIT)

sudo apt-get -y install \
    software-properties-common emacs-nox ethtool curl ca-certificates \
    isc-dhcp-client network-manager netcat gnupg2 \
    python python-setuptools python-dev build-essential python-pip

