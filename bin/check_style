#!/bin/bash -e

ROOT=$(realpath $(dirname $0)/..)
RESULTS=local/lint_results.txt
PYLINTRC=$ROOT/.pylintrc

cd $ROOT

pylint --version

echo Saving complete results to $RESULTS
rm -f $RESULTS

failure=
results=
for file in daq/*.py; do
    echo Checking $file... | tee -a $RESULTS
    score=$(pylint --rcfile=$PYLINTRC $file 2>&1 | tee -a $RESULTS | fgrep 'Your code has been' | awk '{print $7}')
    if [ -n "$score" ]; then
        results=true
        if [ "${score%%.*}" != "10" ]; then
            failure=true
        fi
    fi
done

if [ -n "$failure" ]; then
    echo pylint detected errors:
    cat $RESULTS
    false
fi

if [ -z "$results" ]; then
    echo No results reported, that ain\'t right.
    false
fi

echo Success.
