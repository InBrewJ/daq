#!/bin/bash -e

ROOT=$(realpath $(dirname $0)/..)
INSTDIR=$ROOT/inst
IMAGE=daq/runner

if [ "$1" == base ]; then
    IMAGE=daq/base
    shift
fi

sudo rm -rf $INSTDIR
mkdir -p $INSTDIR

docker rm -f daq-runner > /dev/null 2>&1 || true

rm -f $INSTDIR/system.conf
test -f $ROOT/system.conf && cp $ROOT/system.conf $INSTDIR/

docker_args="\
  --env DAQ_CONTAINER=daq/runner \
  -v $INSTDIR:/root/daq/inst \
"

docker run --privileged --name daq-runner $base_flags $docker_args -ti $IMAGE "$@"
